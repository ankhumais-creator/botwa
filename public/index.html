<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Web</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Dependencies -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <!-- Custom Styles -->
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <!-- Notification Sound -->
    <audio id="notification-sound" src="https://cdn.pixabay.com/audio/2022/12/12/audio_e9f45cf54e.mp3"
        preload="auto"></audio>

    <!-- Green Top Bar -->
    <div class="fixed top-0 left-0 w-full h-[127px] bg-[#00a884] z-0"></div>

    <!-- Main Container -->
    <div class="relative z-10 h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-[1600px] h-[calc(100vh-40px)] bg-white flex shadow-lg overflow-hidden">

            <!-- ========== SIDEBAR ========== -->
            <div class="w-[400px] flex flex-col border-r border-[#d1d7db] bg-white">

                <!-- Sidebar Header -->
                <div class="h-[60px] bg-[#f0f2f5] flex items-center justify-between px-4 border-b border-[#d1d7db]">
                    <button type="button" id="btn-settings-avatar"
                        class="w-10 h-10 rounded-full bg-[#dfe5e7] flex items-center justify-center cursor-pointer"
                        aria-label="Open settings">
                        <svg viewBox="0 0 212 212" width="40" height="40">
                            <path fill="#DFE5E7"
                                d="M106.251.5C164.653.5 212 47.846 212 106.25S164.653 212 106.25 212C47.846 212 .5 164.654.5 106.25S47.846.5 106.251.5z" />
                            <path fill="#FFF"
                                d="M173.561 171.615a62.767 62.767 0 0 0-2.065-2.955 67.7 67.7 0 0 0-2.608-3.299 70.112 70.112 0 0 0-3.184-3.527 71.097 71.097 0 0 0-5.924-5.47 72.458 72.458 0 0 0-10.204-7.026 75.2 75.2 0 0 0-5.98-3.055c-.062-.028-.118-.059-.18-.087-9.792-4.44-22.106-7.529-37.416-7.529s-27.624 3.089-37.416 7.529c-.338.153-.653.318-.985.474a75.37 75.37 0 0 0-6.229 3.298 72.589 72.589 0 0 0-9.15 6.395 71.243 71.243 0 0 0-5.924 5.47 70.064 70.064 0 0 0-3.184 3.527 67.142 67.142 0 0 0-2.609 3.299 63.292 63.292 0 0 0-2.065 2.955 56.33 56.33 0 0 0-1.447 2.324c-.033.056-.073.119-.104.174a47.92 47.92 0 0 0-1.07 1.926c-.559 1.068-.818 1.678-.818 1.678v.398c18.285 17.927 43.322 28.985 70.945 28.985 27.678 0 52.761-11.103 71.055-29.095v-.289s-.619-1.45-1.992-3.778a58.346 58.346 0 0 0-1.446-2.322zM106.002 125.5c2.645 0 5.212-.253 7.68-.737a38.272 38.272 0 0 0 3.624-.896 37.124 37.124 0 0 0 5.12-1.958 36.307 36.307 0 0 0 6.15-3.67 35.923 35.923 0 0 0 9.489-10.48 36.558 36.558 0 0 0 2.422-4.84 37.051 37.051 0 0 0 1.716-5.25c.299-1.208.542-2.443.725-3.701.275-1.887.417-3.827.417-5.811s-.142-3.925-.417-5.811a38.734 38.734 0 0 0-1.215-5.494 36.68 36.68 0 0 0-3.648-8.298 35.923 35.923 0 0 0-9.489-10.48 36.347 36.347 0 0 0-6.15-3.67 37.124 37.124 0 0 0-5.12-1.958 37.67 37.67 0 0 0-3.624-.896 39.875 39.875 0 0 0-7.68-.737c-21.162 0-37.345 16.183-37.345 37.345 0 21.159 16.183 37.342 37.345 37.342z" />
                        </svg>
                    </button>
                    <div class="flex gap-6 text-[#54656f]">
                        <button id="btn-new-chat" title="New chat" class="hover:text-[#00a884] transition-colors">
                            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                                <path
                                    d="M19.005 3.175H4.674C3.642 3.175 3 3.789 3 4.821V21.02l3.544-3.514h12.461c1.033 0 2.064-1.06 2.064-2.093V4.821c-.001-1.032-1.032-1.646-2.064-1.646zm-4.989 9.869H7.041V11.1h6.975v1.944zm3-4H7.041V7.1h9.975v1.944z" />
                            </svg>
                        </button>
                        <button id="btn-settings-menu" title="Settings" class="hover:text-[#00a884] transition-colors">
                            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                                <path
                                    d="M12 7a2 2 0 1 0-.001-4.001A2 2 0 0 0 12 7zm0 2a2 2 0 1 0-.001 3.999A2 2 0 0 0 12 9zm0 6a2 2 0 1 0-.001 3.999A2 2 0 0 0 12 15z" />
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Search Bar -->
                <div class="h-[50px] bg-white flex items-center px-3 border-b border-[#f0f2f5]">
                    <div class="flex-1 h-[35px] bg-[#f0f2f5] rounded-lg flex items-center px-3 gap-3">
                        <svg viewBox="0 0 24 24" width="18" height="18" class="text-[#54656f]">
                            <path fill="currentColor"
                                d="M15.009 13.805h-.636l-.22-.219a5.184 5.184 0 0 0 1.256-3.386 5.207 5.207 0 1 0-5.207 5.208 5.183 5.183 0 0 0 3.385-1.255l.221.22v.635l4.004 3.999 1.194-1.195-3.997-4.007zm-4.808 0a3.605 3.605 0 1 1 0-7.21 3.605 3.605 0 0 1 0 7.21z" />
                        </svg>
                        <input type="search" id="search-input" name="wa-search-filter-7f71"
                            placeholder="Search or start new chat"
                            class="flex-1 bg-transparent text-[13px] text-[#3b4a54] outline-none placeholder-[#667781]"
                            autocomplete="new-password" autocorrect="off" autocapitalize="off" spellcheck="false"
                            data-lpignore="true" data-form-type="other">
                    </div>
                </div>

                <!-- Contact List -->
                <div id="contact-list" class="flex-1 overflow-y-auto">
                    <div id="empty-contacts"
                        class="flex flex-col items-center justify-center h-full text-[#667781] text-sm">
                        <svg viewBox="0 0 303 172" width="200" class="mb-4 opacity-40">
                            <path fill="currentColor"
                                d="M229.565 160.229c32.647-12.996 53.696-36.138 53.696-62.229 0-42.024-54.144-76.116-120.949-76.116S41.363 55.976 41.363 98c0 26.091 21.049 49.233 53.696 62.229L75.56 172l47.158-12.758c10.641 2.69 22.008 4.146 33.882 4.146 11.874 0 23.241-1.456 33.882-4.146L237.64 172l-8.075-11.771z" />
                        </svg>
                        <p>No chats yet</p>
                        <p class="text-xs mt-1">Messages will appear here</p>
                    </div>
                </div>
            </div>

            <!-- ========== MAIN CHAT AREA ========== -->
            <div class="flex-1 flex flex-col bg-[#f0f2f5] relative">

                <!-- Empty State / Welcome -->
                <div id="welcome-screen"
                    class="absolute inset-0 flex flex-col items-center justify-center bg-[#f0f2f5] z-10 border-b-[6px] border-[#00a884]">
                    <img src="https://web.whatsapp.com/img/intro-connection-light_c98cc75f2aa905314d74e4d8b31b63d4.jpg"
                        alt="" class="w-[320px] mb-8 opacity-80">
                    <h1 class="text-[32px] font-light text-[#41525d] mb-3">WhatsApp Web AI</h1>
                    <p class="text-[#667781] text-sm text-center max-w-md">Send and receive messages with AI
                        assistance.<br>Select a chat to get started.</p>
                </div>

                <!-- Chat Container -->
                <div id="chat-container" class="hidden flex-1 flex flex-col h-full">

                    <!-- Chat Header -->
                    <div class="h-[60px] bg-[#f0f2f5] flex items-center justify-between px-4 border-l border-[#d1d7db]">
                        <div class="flex items-center gap-3 cursor-pointer">
                            <div id="chat-avatar"
                                class="w-10 h-10 rounded-full bg-[#dfe5e7] flex items-center justify-center text-[#54656f] font-medium text-sm">
                                ?</div>
                            <div>
                                <h2 id="chat-name" class="text-[16px] text-[#111b21] font-normal">Contact</h2>
                                <p id="chat-status" class="text-[13px] text-[#667781]">online</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-4">
                            <!-- Search Button -->
                            <button id="btn-search-messages" type="button" title="Search messages"
                                class="text-[#54656f] hover:text-[#00a884] transition-colors">
                                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                                    <path
                                        d="M15.009 13.805h-.636l-.22-.219a5.184 5.184 0 0 0 1.256-3.386 5.207 5.207 0 1 0-5.207 5.208 5.183 5.183 0 0 0 3.385-1.255l.221.22v.635l4.004 3.999 1.194-1.195-3.997-4.007zm-4.808 0a3.605 3.605 0 1 1 0-7.21 3.605 3.605 0 0 1 0 7.21z" />
                                </svg>
                            </button>

                            <!-- AI Toggle -->
                            <button type="button" id="btn-toggle-ai"
                                class="flex items-center gap-2 bg-white px-3 py-1.5 rounded-full border border-[#d1d7db] cursor-pointer select-none"
                                aria-label="Toggle AI">
                                <span id="ai-label" class="text-[12px] font-medium text-[#00a884]">ðŸ¤– AI ON</span>
                                <div id="ai-toggle"
                                    class="w-8 h-4 bg-[#00a884] rounded-full relative transition-colors">
                                    <div id="ai-dot"
                                        class="w-3 h-3 bg-white rounded-full absolute top-0.5 right-0.5 transition-all shadow-sm">
                                    </div>
                                </div>
                            </button>
                            <button class="text-[#54656f] hover:text-[#00a884] transition-colors">
                                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                                    <path
                                        d="M12 7a2 2 0 1 0-.001-4.001A2 2 0 0 0 12 7zm0 2a2 2 0 1 0-.001 3.999A2 2 0 0 0 12 9zm0 6a2 2 0 1 0-.001 3.999A2 2 0 0 0 12 15z" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Search Bar (Hidden by default) -->
                    <div id="search-bar"
                        class="hidden h-[60px] bg-[#f0f2f5] flex items-center gap-3 px-4 border-b border-[#d1d7db]">
                        <div class="flex-1 flex items-center gap-2 bg-white rounded-lg px-3 py-2">
                            <svg viewBox="0 0 24 24" width="20" height="20" class="text-[#667781]">
                                <path fill="currentColor"
                                    d="M15.009 13.805h-.636l-.22-.219a5.184 5.184 0 0 0 1.256-3.386 5.207 5.207 0 1 0-5.207 5.208 5.183 5.183 0 0 0 3.385-1.255l.221.22v.635l4.004 3.999 1.194-1.195-3.997-4.007zm-4.808 0a3.605 3.605 0 1 1 0-7.21 3.605 3.605 0 0 1 0 7.21z" />
                            </svg>
                            <input type="text" id="search-messages-input" placeholder="Search in messages..."
                                class="flex-1 text-[14px] text-[#3b4a54] outline-none bg-transparent">
                        </div>

                        <div class="flex items-center gap-2">
                            <!-- Results Counter -->
                            <span id="search-counter"
                                class="text-[13px] text-[#667781] min-w-[60px] text-center"></span>

                            <!-- Navigation Buttons -->
                            <button id="btn-search-prev" type="button" title="Previous"
                                class="w-8 h-8 flex items-center justify-center text-[#54656f] hover:bg-white rounded-full transition-colors disabled:opacity-30 disabled:cursor-not-allowed">
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                                    <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" />
                                </svg>
                            </button>
                            <button id="btn-search-next" type="button" title="Next"
                                class="w-8 h-8 flex items-center justify-center text-[#54656f] hover:bg-white rounded-full transition-colors disabled:opacity-30 disabled:cursor-not-allowed">
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                                    <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z" />
                                </svg>
                            </button>

                            <!-- Close Button -->
                            <button id="btn-close-search" type="button" title="Close search"
                                class="w-8 h-8 flex items-center justify-center text-[#54656f] hover:bg-white rounded-full transition-colors">
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                                    <path
                                        d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Messages Area -->
                    <div id="messages" class="flex-1 overflow-y-auto chat-pattern p-4 lg:px-16 py-4"></div>

                    <!-- Input Area -->
                    <div class="h-[62px] bg-[#f0f2f5] flex items-center gap-3 px-4 border-t border-[#d1d7db]">
                        <button class="text-[#54656f] hover:text-[#00a884] transition-colors">
                            <svg viewBox="0 0 24 24" width="26" height="26" fill="currentColor">
                                <path
                                    d="M9.153 11.603c.795 0 1.439-.879 1.439-1.962s-.644-1.962-1.439-1.962-1.439.879-1.439 1.962.644 1.962 1.439 1.962zm-3.204 1.362c-.026-.307-.131 5.218 6.063 5.551 6.066-.25 6.066-5.551 6.066-5.551-6.078 1.416-12.129 0-12.129 0zm11.363 1.108s-.669 1.959-5.051 1.959c-3.505 0-5.388-1.164-5.607-1.959 0 0 5.912 1.055 10.658 0zM11.804 1.011C5.609 1.011.978 6.033.978 12.228s4.826 10.761 11.021 10.761S23.02 18.423 23.02 12.228c.001-6.195-5.021-11.217-11.216-11.217zM12 21.354c-5.273 0-9.381-3.886-9.381-9.159s3.942-9.548 9.215-9.548 9.548 4.275 9.548 9.548c-.001 5.272-4.113 9.159-9.382 9.159zm3.108-9.751c.795 0 1.439-.879 1.439-1.962s-.644-1.962-1.439-1.962-1.439.879-1.439 1.962.644 1.962 1.439 1.962z" />
                            </svg>
                        </button>
                        <div class="flex-1 bg-white rounded-lg px-4 py-2 flex items-center">
                            <input type="text" id="message-input" placeholder="Type a message"
                                class="flex-1 text-[15px] text-[#3b4a54] outline-none">
                        </div>
                        <button id="btn-send-message" class="text-[#54656f] hover:text-[#00a884] transition-colors">
                            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                                <path
                                    d="M1.101 21.757 23.8 12.028 1.101 2.3l.011 7.912 13.623 1.816-13.623 1.817-.011 7.912z" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- ========== SETTINGS PANEL ========== -->
            <div id="settings-panel"
                class="hidden absolute top-0 left-0 w-[400px] h-full bg-white z-50 flex flex-col animate-slideIn">
                <div class="h-[108px] bg-[#00a884] flex items-end px-6 pb-4 gap-6">
                    <button id="btn-close-settings" class="text-white">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                            <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
                        </svg>
                    </button>
                    <span class="text-white text-[19px] font-medium">Settings</span>
                </div>

                <div class="flex-1 overflow-y-auto bg-[#f0f2f5]">
                    <!-- QR Card -->
                    <div id="qr-card" class="hidden m-4 p-6 bg-white rounded-lg shadow-sm text-center">
                        <p class="text-[#3b4a54] text-sm mb-4">Scan QR to connect WhatsApp</p>
                        <div id="qrcode" class="inline-block"></div>
                    </div>

                    <!-- Config -->
                    <div class="m-4 p-4 bg-white rounded-lg shadow-sm space-y-4">
                        <h3 class="text-[#00a884] text-xs font-bold uppercase tracking-wide">AI Configuration</h3>
                        <div>
                            <label for="inp-model" class="text-[11px] text-[#667781] uppercase">Model</label>
                            <input type="text" id="inp-model"
                                class="w-full border-b border-[#d1d7db] py-2 text-[14px] text-[#3b4a54] outline-none focus:border-[#00a884] transition-colors">
                        </div>
                        <div>
                            <label for="inp-prompt" class="text-[11px] text-[#667781] uppercase">System Prompt</label>
                            <textarea id="inp-prompt" rows="3"
                                class="w-full border-b border-[#d1d7db] py-2 text-[14px] text-[#3b4a54] outline-none focus:border-[#00a884] transition-colors resize-none"></textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label for="inp-url" class="text-[11px] text-[#667781] uppercase">Base URL</label>
                                <input type="text" id="inp-url"
                                    class="w-full border-b border-[#d1d7db] py-2 text-[12px] text-[#3b4a54] outline-none focus:border-[#00a884] transition-colors">
                            </div>
                            <div>
                                <label for="inp-key" class="text-[11px] text-[#667781] uppercase">API Key</label>
                                <input type="password" id="inp-key"
                                    class="w-full border-b border-[#d1d7db] py-2 text-[12px] text-[#3b4a54] outline-none focus:border-[#00a884] transition-colors">
                            </div>
                        </div>
                        <button id="btn-save-settings"
                            class="w-full bg-[#00a884] text-white py-2.5 rounded-lg text-[14px] font-medium hover:bg-[#008f72] transition-colors">Save
                            Changes</button>
                    </div>

                    <!-- Danger Zone -->
                    <div class="m-4 p-4 bg-white rounded-lg shadow-sm">
                        <h3 class="text-red-500 text-xs font-bold uppercase tracking-wide mb-3">Danger Zone</h3>
                        <button id="btn-shutdown"
                            class="w-full border border-red-300 text-red-500 py-2.5 rounded-lg text-[14px] font-medium hover:bg-red-50 transition-colors">Shutdown
                            System</button>
                    </div>
                </div>
            </div>

            <!-- ========== CONTEXT MENU ========== -->
            <div id="context-menu" class="context-menu hidden">
                <button type="button" id="btn-rename-contact" class="context-menu-item">Rename contact</button>
                <button type="button" id="btn-delete-contact" class="context-menu-item danger">Delete chat</button>
            </div>

            <!-- ========== NEW CHAT MODAL ========== -->
            <div id="new-chat-modal"
                class="hidden absolute inset-0 bg-black/50 z-[80] flex items-center justify-center">
                <div class="bg-white w-[400px] rounded-lg shadow-xl overflow-hidden animate-fadeInUp">
                    <div class="bg-[#00a884] px-6 py-4">
                        <h3 class="text-white text-lg font-medium">Start New Chat</h3>
                    </div>
                    <div class="p-6">
                        <label for="new-chat-input" class="text-sm text-[#667781] block mb-2">Enter phone number</label>
                        <input type="text" id="new-chat-input" placeholder="e.g. 628123456789"
                            class="w-full border border-[#d1d7db] rounded-lg px-4 py-3 text-[15px] outline-none focus:border-[#00a884] transition-colors">
                        <p class="text-xs text-[#667781] mt-2">Format: Country code + number (without + or spaces)</p>
                    </div>
                    <div class="flex border-t border-[#f0f2f5]">
                        <button id="btn-cancel-chat" type="button"
                            class="flex-1 py-3 text-[#667781] hover:bg-[#f5f6f6] transition-colors font-medium">Cancel</button>
                        <button id="btn-start-chat" type="button"
                            class="flex-1 py-3 text-[#00a884] hover:bg-[#f5f6f6] transition-colors font-medium border-l border-[#f0f2f5]">Start
                            Chat</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== OFFLINE OVERLAY ========== -->
        <div id="offline-overlay"
            class="hidden absolute inset-0 bg-[#111b21]/90 z-[100] flex items-center justify-center">
            <div class="text-center text-white">
                <div class="text-5xl mb-4">ðŸŒ™</div>
                <h1 class="text-2xl font-light mb-2">System Offline</h1>
                <p class="text-sm opacity-70">Server has been shut down</p>
            </div>
        </div>
    </div>
    </div>

    <!-- Application Script with DEFER -->
    <script src="/js/app.js" defer></script>
</body>

</html>